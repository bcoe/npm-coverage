<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for ./lib/access.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../prettify.css">
    <link rel="stylesheet" href="../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">./lib/access.js</span></h1>
    <h2>
        Statements: <span class="metric">81.16% <small>(56 / 69)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">55.56% <small>(20 / 36)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">90.91% <small>(10 / 11)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">84.62% <small>(55 / 65)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../index.html">All files</a> &#187; <a href="index.html">./lib/</a> &#187; access.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</td><td class="line-coverage"><span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var assert = require("assert")
var resolve = require("path").resolve
var url = require("url")
&nbsp;
var log = require("npmlog")
var readPackageJson = require("read-package-json")
&nbsp;
var mapToRegistry = require("./utils/map-to-registry.js")
var npa = require("npm-package-arg")
var npm = require("./npm.js")
&nbsp;
module.exports = access
&nbsp;
access.usage = "npm access public [&lt;package&gt;]"
             + "\nnpm access restricted [&lt;package&gt;]"
             + "\nnpm access add &lt;read-only|read-write&gt; &lt;entity&gt; [&lt;package&gt;]"
             + "\nnpm access rm &lt;entity&gt; [&lt;package&gt;]"
             + "\nnpm access ls [&lt;package&gt;]"
             + "\nnpm access edit [&lt;package&gt;]"
&nbsp;
access.completion = <span class="fstat-no" title="function not covered" >function (opts, cb) {</span>
<span class="cstat-no" title="statement not covered" >  var argv = opts.conf.argv.remain</span>
<span class="cstat-no" title="statement not covered" >  if (argv.length === 2) {</span>
<span class="cstat-no" title="statement not covered" >    return cb(null, ["public", "restricted", "add", "rm", "ls", "edit"])</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  switch (argv[2]) {</span>
    case "public":
    case "restricted":
    case "ls":
    case "edit":
<span class="cstat-no" title="statement not covered" >      return cb(new Error("unimplemented: packages you can change"))</span>
    case "add":
<span class="cstat-no" title="statement not covered" >      if (argv.length === 3) <span class="cstat-no" title="statement not covered" >return cb(null, ["read-only", "read-write"])</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      return cb(new Error("unimplemented: entities and packages"))</span>
    case "rm":
<span class="cstat-no" title="statement not covered" >      return cb(new Error("unimplemented: entities and packages"))</span>
    default:
<span class="cstat-no" title="statement not covered" >      return cb(new Error(argv[2]+" not recognized"))</span>
  }
}
&nbsp;
function access (args, cb) {
  var cmd = args.shift()
  switch (cmd) {
    case "public": case "restricted": return changeAccess(args, cmd, cb)
    case "add": case "set": return add(args, cb)
    case "rm": case "del": case "clear": return rm(args, cb)
<span class="branch-7 cbranch-no" title="branch not covered" >    case "list": <span class="branch-8 cbranch-no" title="branch not covered" ></span>case "sl": </span>case "ls": return ls(args, cb)
    case "edit": case "ed": return edit(args, cb)
    default: return cb("Usage:\n"+access.usage)
  }
}
&nbsp;
function changeAccess (args, level, cb) {
  assert(Array.isArray(args), "changeAccess requires args be an array")
  assert(
    ["public", "restricted"].indexOf(level) !== -1,
    "access level must be either 'public' or 'restricted'"
  )
  assert(typeof cb === "function", "changeAccess requires a callback")
&nbsp;
  var p = (args.shift() || "").trim()
  if (!p) return getCurrentPackage(level, cb)
  changeAccess_(p, level, cb)
}
&nbsp;
function getCurrentPackage (level, cb) {
  var here = resolve(npm.prefix, "package.json")
  log.verbose("setPackageLevel", "here", here)
&nbsp;
  readPackageJson(here, function (er, data) {
    <span class="missing-if-branch" title="if path not taken" >I</span>if (er) <span class="cstat-no" title="statement not covered" >return cb(er)</span>
&nbsp;
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!data.name) {
<span class="cstat-no" title="statement not covered" >      return cb(new Error("Package must be named"))</span>
    }
&nbsp;
    changeAccess_(data.name, level, cb)
  })
}
&nbsp;
function changeAccess_ (name, level, cb) {
  log.verbose("changeAccess", "name", name, "level", level)
  mapToRegistry(name, npm.config, function (er, uri, auth, base) {
    <span class="missing-if-branch" title="if path not taken" >I</span>if (er) <span class="cstat-no" title="statement not covered" >return cb(er)</span>
&nbsp;
    var data = npa(name)
    if (!data.scope) {
      var msg = "Sorry, you can't change the access level of unscoped packages."
      log.error("access", msg)
      return cb(new Error(msg))
    }
&nbsp;
    // name must be scoped, so escape separator
    name = name.replace("/", "%2f")
    // FIXME: mapToRegistry still isn't generic enough SIGH
    uri = url.resolve(base, "-/package/"+name+"/access")
    var params = {
      level : level,
      auth : auth
    }
&nbsp;
    npm.registry.access(uri, params, cb)
  })
}
&nbsp;
function add (args, cb) {
  return cb(new Error("npm access add isn't implemented yet!"))
}
&nbsp;
function rm (args, cb) {
  return cb(new Error("npm access rm isn't implemented yet!"))
}
&nbsp;
function ls (args, cb) {
  return cb(new Error("npm access ls isn't implemented yet!"))
}
&nbsp;
function edit (args, cb) {
  return cb(new Error("npm access edit isn't implemented yet!"))
}
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat May 16 2015 16:39:59 GMT-0700 (PDT)</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
